{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=app_label %}">{{ app_label|capfirst|escape }}</a>
&rsaquo; <a href="../">Q&A Entries</a>
&rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>
<p class="help">{{ subtitle }}</p>

<!-- Statistics Overview -->
<div class="module aligned" style="margin-bottom: 20px;">
    <h2>ğŸ“Š Thá»‘ng kÃª tá»•ng quan</h2>
    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        <div class="form-row" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-width: 150px;">
            <div style="font-size: 24px; font-weight: bold; color: #007cba;">{{ stats.total_entries }}</div>
            <div style="font-size: 12px; color: #666;">Tá»•ng sá»‘ Q&A</div>
        </div>
        <div class="form-row" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-width: 150px;">
            <div style="font-size: 24px; font-weight: bold; color: #28a745;">{{ stats.active_entries }}</div>
            <div style="font-size: 12px; color: #666;">Äang kÃ­ch hoáº¡t</div>
        </div>
        <div class="form-row" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-width: 150px;">
            <div style="font-size: 24px; font-weight: bold; color: #17a2b8;">{{ stats.synced_entries }}</div>
            <div style="font-size: 12px; color: #666;">ÄÃ£ sync</div>
        </div>
        <div class="form-row" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-width: 150px;">
            <div style="font-size: 24px; font-weight: bold; color: #ffc107;">{{ stats.pending_entries }}</div>
            <div style="font-size: 12px; color: #666;">Chá» sync</div>
        </div>
        <div class="form-row" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-width: 150px;">
            <div style="font-size: 24px; font-weight: bold; color: #dc3545;">{{ stats.error_entries }}</div>
            <div style="font-size: 12px; color: #666;">Lá»—i sync</div>
        </div>
    </div>
</div>

<!-- Drive Status -->
<div class="module aligned" style="margin-bottom: 20px;">
    <h2>â˜ï¸ Tráº¡ng thÃ¡i Google Drive</h2>
    {% if drive_status.connected %}
        {% if drive_status.file_exists %}
            <div style="background: #d4edda; padding: 15px; border-radius: 5px; border-left: 4px solid #28a745;">
                <strong>âœ… Káº¿t ná»‘i thÃ nh cÃ´ng</strong><br>
                ğŸ“ File: {{ drive_status.file_name }}<br>
                ğŸ“¦ KÃ­ch thÆ°á»›c: {{ drive_status.file_size|filesizeformat }}<br>
                ğŸ•’ Cáº­p nháº­t: {{ drive_status.modified_time|date:"d/m/Y H:i" }}
            </div>
        {% else %}
            <div style="background: #fff3cd; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107;">
                <strong>âš ï¸ Káº¿t ná»‘i OK nhÆ°ng khÃ´ng tÃ¬m tháº¥y file CSV</strong><br>
                HÃ£y thá»±c hiá»‡n Export Ä‘á»ƒ táº¡o file má»›i.
            </div>
        {% endif %}
    {% else %}
        <div style="background: #f8d7da; padding: 15px; border-radius: 5px; border-left: 4px solid #dc3545;">
            <strong>âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i Google Drive</strong><br>
            Lá»—i: {{ drive_status.error|default:"Unknown error" }}
        </div>
    {% endif %}
</div>

<!-- Main Tools -->
<div class="module aligned">
    <h2>ğŸ› ï¸ CÃ´ng cá»¥ chÃ­nh</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        
        <!-- Import from Drive -->
        <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
            <h3 style="margin-top: 0; color: #007cba;">ğŸ“¥ Import tá»« Google Drive</h3>
            <p>Táº£i dá»¯ liá»‡u Q&A tá»« Google Drive vá» database. Sáº½ cáº­p nháº­t hoáº·c táº¡o má»›i cÃ¡c entries.</p>
            <a href="{{ import_url }}" class="button" style="background: #007cba; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">
                Báº¯t Ä‘áº§u Import
            </a>
        </div>

        <!-- Export to Drive -->
        <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
            <h3 style="margin-top: 0; color: #28a745;">ğŸ“¤ Export lÃªn Google Drive</h3>
            <p>Äá»“ng bá»™ toÃ n bá»™ dá»¯ liá»‡u Q&A tá»« database lÃªn Google Drive. Sáº½ ghi Ä‘Ã¨ file hiá»‡n táº¡i.</p>
            <a href="{{ export_url }}" class="button" style="background: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">
                Báº¯t Ä‘áº§u Export
            </a>
        </div>

        <!-- Bulk Import -->
        <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
            <h3 style="margin-top: 0; color: #17a2b8;">ğŸ“‹ Bulk Import tá»« CSV</h3>
            <p>Upload file CSV tá»« mÃ¡y tÃ­nh Ä‘á»ƒ import hÃ ng loáº¡t Q&A entries vÃ o database.</p>
            <a href="{{ bulk_import_url }}" class="button" style="background: #17a2b8; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">
                Upload CSV
            </a>
        </div>

        <!-- Sync Status -->
        <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
            <h3 style="margin-top: 0; color: #6f42c1;">ğŸ“Š Sync Status Dashboard</h3>
            <p>Xem chi tiáº¿t tráº¡ng thÃ¡i Ä‘á»“ng bá»™ vÃ  lá»‹ch sá»­ cÃ¡c hoáº¡t Ä‘á»™ng sync.</p>
            <a href="{{ sync_status_url }}" class="button" style="background: #6f42c1; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">
                Xem Dashboard
            </a>
        </div>
    </div>
</div>

<!-- Recent Sync Logs -->
{% if recent_logs %}
<div class="module aligned" style="margin-top: 20px;">
    <h2>ğŸ“‹ Hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y</h2>
    <div class="results">
        <table id="result_list" style="width: 100%;">
            <thead>
                <tr>
                    <th>Thao tÃ¡c</th>
                    <th>Tráº¡ng thÃ¡i</th>
                    <th>Thá»i gian</th>
                    <th>Káº¿t quáº£</th>
                    <th>Tá»· lá»‡ thÃ nh cÃ´ng</th>
                </tr>
            </thead>
            <tbody>
                {% for log in recent_logs %}
                <tr>
                    <td>{{ log.get_operation_display }}</td>
                    <td>
                        {% if log.status == 'success' %}
                            <span style="color: #28a745;">âœ… {{ log.get_status_display }}</span>
                        {% elif log.status == 'partial' %}
                            <span style="color: #ffc107;">âš ï¸ {{ log.get_status_display }}</span>
                        {% else %}
                            <span style="color: #dc3545;">âŒ {{ log.get_status_display }}</span>
                        {% endif %}
                    </td>
                    <td>{{ log.started_at|date:"d/m/Y H:i:s" }}</td>
                    <td>{{ log.entries_success }}/{{ log.entries_processed }}</td>
                    <td>
                        {% if log.success_rate >= 95 %}
                            <span style="color: #28a745; font-weight: bold;">{{ log.success_rate|floatformat:1 }}%</span>
                        {% elif log.success_rate >= 80 %}
                            <span style="color: #ffc107; font-weight: bold;">{{ log.success_rate|floatformat:1 }}%</span>
                        {% else %}
                            <span style="color: #dc3545; font-weight: bold;">{{ log.success_rate|floatformat:1 }}%</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div class="module aligned" style="margin-top: 20px;">
    <h2>âš¡ Thao tÃ¡c nhanh</h2>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="../" class="button default">ğŸ“‹ Quay láº¡i danh sÃ¡ch Q&A</a>
        <a href="{% url 'admin:qa_management_qasynclog_changelist' %}" class="button default">ğŸ“Š Xem táº¥t cáº£ Sync Logs</a>
        <a href="../add/" class="button default">â• ThÃªm Q&A má»›i</a>
    </div>
</div>

<!-- Help Section -->
<div class="module aligned" style="margin-top: 20px; background: #f8f9fa;">
    <h2>â“ HÆ°á»›ng dáº«n sá»­ dá»¥ng</h2>
    <div style="padding: 15px;">
        <h4>ğŸ”„ Quy trÃ¬nh Ä‘á»“ng bá»™ chuáº©n:</h4>
        <ol>
            <li><strong>ThÃªm/Sá»­a Q&A:</strong> Sá»­ dá»¥ng giao diá»‡n admin Ä‘á»ƒ thÃªm hoáº·c sá»­a cÃ¢u há»i</li>
            <li><strong>Sync riÃªng láº»:</strong> Chá»n entries cáº§n sync vÃ  dÃ¹ng action "Sync cÃ¡c entries Ä‘Ã£ chá»n"</li>
            <li><strong>Export toÃ n bá»™:</strong> DÃ¹ng "Export lÃªn Google Drive" Ä‘á»ƒ Ä‘á»“ng bá»™ táº¥t cáº£</li>
            <li><strong>Kiá»ƒm tra:</strong> Xem "Sync Status Dashboard" Ä‘á»ƒ theo dÃµi káº¿t quáº£</li>
        </ol>
        
        <h4>ğŸ“¥ Import dá»¯ liá»‡u:</h4>
        <ul>
            <li><strong>Tá»« Drive:</strong> Import dá»¯ liá»‡u cÃ³ sáºµn trÃªn Google Drive</li>
            <li><strong>Tá»« CSV:</strong> Upload file CSV tá»« mÃ¡y tÃ­nh (Ä‘á»‹nh dáº¡ng: STT, question, answer)</li>
        </ul>
        
        <h4>âš ï¸ LÆ°u Ã½ quan trá»ng:</h4>
        <ul>
            <li>Export sáº½ ghi Ä‘Ã¨ toÃ n bá»™ file trÃªn Drive</li>
            <li>Import sáº½ cáº­p nháº­t hoáº·c táº¡o má»›i entries dá»±a trÃªn STT</li>
            <li>LuÃ´n kiá»ƒm tra Sync Status sau má»—i thao tÃ¡c</li>
            <li>File CSV pháº£i cÃ³ Ä‘Ãºng Ä‘á»‹nh dáº¡ng: STT, question, answer</li>
        </ul>
    </div>
</div>

<style>
.button {
    display: inline-block;
    padding: 8px 16px;
    background: #007cba;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-size: 13px;
}

.button:hover {
    background: #005a87;
    color: white;
    text-decoration: none;
}

.button.default {
    background: #6c757d;
}

.button.default:hover {
    background: #545b62;
}

.module h2 {
    background: #417690;
    color: white;
    padding: 10px 15px;
    margin: 0 0 15px 0;
    border-radius: 5px 5px 0 0;
}

.module {
    border: 1px solid #ddd;
    border-radius: 5px;
    background: white;
}

.module.aligned {
    padding: 0;
}

.module.aligned > div,
.module.aligned > p {
    padding: 0 15px 15px 15px;
}
</style>
{% endblock %}