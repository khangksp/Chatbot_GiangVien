{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}Export l√™n Google Drive | Django Admin{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Trang ch·ªß</a>
    &rsaquo; <a href="{% url 'admin:qa_management_qaentry_changelist' %}">Q&A Entries</a>
    &rsaquo; Export l√™n Google Drive
</div>
{% endblock %}

{% block content %}
<div class="module aligned" style="max-width: 800px;">
    <h1>üì§ Export Q&A l√™n Google Drive</h1>
    
    <div class="form-row" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #17a2b8;">
        <h3 style="color: #17a2b8; margin-top: 0;">‚ÑπÔ∏è Th√¥ng tin Export</h3>
        <ul style="margin: 0;">
            <li><strong>T·ªïng s·ªë entries:</strong> {{ total_entries }} entries</li>
            <li><strong>ƒê√≠ch ƒë·∫øn:</strong> File QA.csv tr√™n Google Drive</li>
            <li><strong>Format:</strong> CSV v·ªõi c·∫•u tr√∫c STT,question,answer,,</li>
            <li><strong>Ch·ªâ export:</strong> C√°c entries ƒëang active</li>
        </ul>
    </div>
    
    <div class="form-row" style="margin: 20px 0; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107;">
        <h3 style="color: #856404; margin-top: 0;">‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng</h3>
        <ul style="margin: 0; color: #856404;">
            <li>Thao t√°c n√†y s·∫Ω <strong>ghi ƒë√® ho√†n to√†n</strong> file QA.csv tr√™n Drive</li>
            <li>D·ªØ li·ªáu c≈© tr√™n Drive s·∫Ω b·ªã m·∫•t (tr·ª´ khi c√≥ backup)</li>
            <li>Ch·ªâ export c√°c entries c√≥ <code>is_active = True</code></li>
            <li>Ki·ªÉm tra quy·ªÅn write tr√™n Google Drive</li>
        </ul>
    </div>
    
    {% if total_entries == 0 %}
    <div class="form-row" style="margin: 20px 0; padding: 15px; background: #f8d7da; border-left: 4px solid #dc3545;">
        <h3 style="color: #721c24; margin-top: 0;">‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu</h3>
        <p style="margin: 0; color: #721c24;">
            Kh√¥ng c√≥ entries n√†o ƒë·ªÉ export. Vui l√≤ng th√™m d·ªØ li·ªáu tr∆∞·ªõc khi export.
        </p>
    </div>
    {% else %}
    <form method="post" style="margin-top: 30px;">
        {% csrf_token %}
        
        <div class="form-row">
            <div class="field-box">
                <h2>X√°c nh·∫≠n Export</h2>
                <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën export <strong>{{ total_entries }} entries</strong> l√™n Google Drive kh√¥ng?</p>
                
                <div style="margin: 20px 0;">
                    <label>
                        <input type="checkbox" id="confirm_export" required>
                        T√¥i hi·ªÉu r·∫±ng d·ªØ li·ªáu tr√™n Drive s·∫Ω b·ªã ghi ƒë√®
                    </label>
                </div>
                
                <div style="margin: 20px 0;">
                    <label>
                        <input type="checkbox" id="create_backup" checked>
                        T·∫°o backup file Drive hi·ªán t·∫°i tr∆∞·ªõc khi export (khuy·∫øn ngh·ªã)
                    </label>
                </div>
                
                <div style="margin: 20px 0;">
                    <label>
                        <input type="checkbox" id="active_only" checked disabled>
                        Ch·ªâ export entries ƒëang active ({{ total_entries }} entries)
                    </label>
                </div>
            </div>
        </div>
        
        <div class="submit-row">
            <input type="submit" value="üöÄ B·∫Øt ƒë·∫ßu Export" class="default" 
                   onclick="return confirm('‚ö†Ô∏è C·∫¢NH B√ÅO: D·ªØ li·ªáu tr√™n Google Drive s·∫Ω b·ªã ghi ƒë√®!\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ti·∫øp t·ª•c?');">
            <a href="{% url 'admin:qa_management_qaentry_changelist' %}" class="button cancel-link">
                H·ªßy b·ªè
            </a>
        </div>
    </form>
    {% endif %}
    
    <div class="form-row" style="margin-top: 30px; padding: 15px; background: #d4edda; border-left: 4px solid #28a745;">
        <h3 style="color: #155724; margin-top: 0;">üí° Thao t√°c khuy·∫øn ngh·ªã</h3>
        <ol style="margin: 0; color: #155724;">
            <li>Ki·ªÉm tra d·ªØ li·ªáu trong database tr∆∞·ªõc khi export</li>
            <li>T·∫°o backup d·ªØ li·ªáu Drive hi·ªán t·∫°i</li>
            <li>Th·ª±c hi·ªán export</li>
            <li>Ki·ªÉm tra file tr√™n Drive sau khi export xong</li>
            <li>Test chatbot ƒë·ªÉ ƒë·∫£m b·∫£o ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng</li>
        </ol>
    </div>
    
    <div class="form-row" style="margin-top: 20px; padding: 15px; background: #cce5ff; border-left: 4px solid #007bff;">
        <h3 style="color: #004085; margin-top: 0;">üîß C√°c thao t√°c kh√°c</h3>
        <ul style="margin: 0; color: #004085;">
            <li><a href="{% url 'admin:qa_sync_status' %}">Xem tr·∫°ng th√°i sync</a></li>
            <li><a href="{% url 'admin:qa_import_from_drive' %}">Import t·ª´ Drive</a></li>
            <li><a href="{% url 'admin:qa_bulk_import' %}">Bulk import t·ª´ CSV</a></li>
        </ul>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmCheckbox = document.getElementById('confirm_export');
    const submitButton = document.querySelector('input[type="submit"]');
    
    if (confirmCheckbox && submitButton) {
        confirmCheckbox.addEventListener('change', function() {
            submitButton.disabled = !this.checked;
            if (this.checked) {
                submitButton.style.opacity = '1';
            } else {
                submitButton.style.opacity = '0.5';
            }
        });
        
        // Initially disable submit button
        submitButton.disabled = true;
        submitButton.style.opacity = '0.5';
    }
});
</script>
{% endblock %}